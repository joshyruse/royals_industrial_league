{%  load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    {% if request.user.is_authenticated and request.user.player_profile %}
      {% if notif_count|add:0 > 0 %}
        ({{ notif_count }}) {{ request.user.player_profile.first_name }} {{ request.user.player_profile.last_name }} - Royals Industrial League
      {% else %}
        {{ request.user.player_profile.first_name }} {{ request.user.player_profile.last_name }} - Royals Industrial League
      {% endif %}
    {% else %}
      Royals Industrial League
    {% endif %}
  </title>
<!-- Favicons & manifest -->
<link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/icons/favicon-32x32.png' %}">
<link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/icons/favicon-16x16.png' %}">
<link rel="apple-touch-icon" href="{% static 'images/icons/apple-touch-icon.png' %}">
<link rel="manifest" href="{% static 'site.webmanifest' %}">
<link rel="preload" as="image" href="{% static 'images/royals_logo.png' %}">
<meta name="theme-color" content="#5e2ea3">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta property="og:title" content="Royals Industrial League">
  <meta property="og:type" content="website">
  <meta property="og:image" content="{% static 'images/icons/android-chrome-512x512.png' %}">
  <meta name="twitter:card" content="summary_large_image">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
    crossorigin="anonymous">
  <link href="{% static 'css/theme.css' %}" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark glass-nav mb-4">
  <div class="container position-relative">
    <button class="navbar-toggler p-2 d-lg-none position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileNav" aria-controls="mobileNav" aria-label="Open menu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand position-absolute start-50 translate-middle-x" href="/" aria-label="Royals Industrial League">
      <img id="navbarLogo" src="{% static 'images/royals_logo.png' %}" data-logo-light="{% static 'images/royals_logo.png' %}"
     data-logo-dark="{% static 'images/royals_logo_white.png' %}" alt="Royals League" class="navbar-logo d-inline-block align-text-top">
    </a>

<!-- Desktop nav (lg and up) -->
<div class="d-none d-lg-flex flex-grow-1">
  <div class="d-flex flex-grow-1">
    <ul class="navbar-nav me-auto flex-column flex-lg-row align-items-lg-center">
      {% if user.is_authenticated %}
      <li class="nav-item">
        <a class="nav-link{% if request.resolver_match and request.resolver_match.url_name == 'schedule_list' %} active{% endif %}"
           href="{% url 'schedule_list' %}">Schedule</a>
      </li>
      {% endif %}
      {% if user.is_authenticated %}
        <li class="nav-item">
          <a class="nav-link{% if request.resolver_match and request.resolver_match.url_name == 'my_results' %} active{% endif %}"
             href="{% url 'my_results' %}">My Results</a>
        </li>
        <li class="nav-item">
          <a class="nav-link{% if request.resolver_match and request.resolver_match.url_name == 'my_team' %} active{% endif %}"
             href="{% url 'my_team' %}">My Team</a>
        </li>
      {% endif %}
      {% if user.is_authenticated %}
        {% if user.is_staff or user.player_profile and user.player_profile.is_captain %}
          <li class="nav-item">
            <a class="nav-link{% if request.resolver_match and request.resolver_match.url_name == 'captain_dashboard' %} active{% endif %}"
               href="{% url 'captain_dashboard' %}">Captain</a>
          </li>
        {% endif %}
      {% endif %}
      {% if user.is_authenticated %}
        {% if user.is_staff %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle{% if request.resolver_match and request.resolver_match.url_name == 'admin_dashboard' or request.resolver_match and request.resolver_match.url_name == 'admin_manage_schedule' or request.resolver_match and request.resolver_match.url_name == 'admin_manage_roster' or request.resolver_match and request.resolver_match.url_name == 'admin_manage_scores' or request.resolver_match and request.resolver_match.url_name == 'admin_manage_players' or request.resolver_match and request.resolver_match.url_name == 'admin_playoff_eligibility' or request.resolver_match and request.resolver_match.url_name == 'admin_league_standings' %} active{% endif %}"
               href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Admin</a>
            <ul class="dropdown-menu" aria-labelledby="adminDropdown">
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_dashboard' %} active{% endif %}"
                   href="{% url 'admin_dashboard' %}">Dashboard</a>
              </li>
              <li><hr class="dropdown-divider my-1"></li>
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_manage_schedule' %} active{% endif %}"
                   href="{% url 'admin_manage_schedule' %}">Manage Schedule</a>
              </li>
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_manage_roster' %} active{% endif %}"
                   href="{% url 'admin_manage_roster' %}">Manage Roster</a>
              </li>
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_manage_scores' %} active{% endif %}"
                   href="{% url 'admin_manage_scores' %}">Manage Scores</a>
              </li>
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_manage_players' %} active{% endif %}"
                   href="{% url 'admin_manage_players' %}">Manage Players</a>
              </li>
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_playoff_eligibility' %} active{% endif %}"
                   href="{% url 'admin_playoff_eligibility' %}">Playoff Eligibility</a>
              </li>
              <li>
                <a class="dropdown-item{% if request.resolver_match and request.resolver_match.url_name == 'admin_league_standings' %} active{% endif %}"
                   href="{% url 'admin_league_standings' %}">League Standings</a>
              </li>
            </ul>
          </li>
        {% endif %}
      {% endif %}
    </ul>
  </div>
  <div class="ms-auto">
    <ul class="navbar-nav align-items-lg-center flex-column flex-lg-row">
      <li class="nav-item me-2 d-flex align-items-center">
        <button id="themeToggle" class="btn btn-sm btn-outline-light" type="button" aria-label="Toggle dark mode">
          <i id="themeToggleIcon" class="bi bi-moon-stars"></i>
        </button>
      </li>
      {% if user.is_authenticated %}
        <li class="nav-item dropdown me-2">
          <a class="nav-link notif-link position-relative" href="#" id="notifDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-bell-fill"></i>
            {% if notif_count %}
              <span class="badge notif-badge rounded-pill bg-primary">{{ notif_count }}</span>
            {% endif %}
          </a>
          <ul class="dropdown-menu dropdown-menu-end dropdown-wide" aria-labelledby="notifDropdown">
            {% if notifications %}
              {% for r in notifications %}
                <li>
                  <a class="dropdown-item" href="{% url 'notification_go' r.id %}">{{ r.notification.title }}</a>
                </li>
              {% endfor %}
              <li><hr class="dropdown-divider"></li>
              <li>
                <form method="post" action="{% url 'notifications_mark_all_read' %}" class="m-0">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item w-100 text-start">Mark all as read</button>
                </form>
              </li>
            {% else %}
              <li><span class="dropdown-item-text text-muted">No new notifications</span></li>
            {% endif %}
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-center" href="{% url 'notifications_list' %}">See all notifications</a></li>
          </ul>
        </li>
        <li class="nav-item me-3 d-flex align-items-center">
          <a class="nav-link profile-link{% if request.resolver_match and request.resolver_match.url_name == 'profile_edit' %} active{% endif %}" href="{% url 'profile_edit' %}">
            <i class="bi bi-person-circle"></i>
            <span>Hi, {% if user.player_profile %}{{ user.player_profile.first_name }} {{ user.player_profile.last_name }}{% else %}{{ user.get_username }}{% endif %}</span>
          </a>
        </li>
        <li class="nav-item d-flex align-items-center">
          <form id="logout-form" method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="nav-link btn btn-link p-0 m-0 align-baseline">Logout</button>
          </form>
        </li>
      {% else %}
        <li class="nav-item"><a class="nav-link" href="{% url 'league_login' %}">Login</a></li>
      {% endif %}
    </ul>
  </div>
</div>

  </div>
</nav>
<!-- Mobile offcanvas nav -->
<div class="offcanvas offcanvas-start glass-offcanvas d-lg-none" tabindex="-1"
     id="mobileNav" aria-labelledby="mobileNavLabel" data-bs-scroll="true" data-bs-backdrop="true">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="mobileNavLabel">Menu</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body d-flex flex-column">
    <ul class="navbar-nav">
      {% if user.is_authenticated %}
      <li class="nav-item"><a class="nav-link" href="{% url 'schedule_list' %}">Schedule</a></li>
      <li class="nav-item"><a class="nav-link" href="{% url 'my_results' %}">My Results</a></li>
      <li class="nav-item"><a class="nav-link" href="{% url 'my_team' %}">My Team</a></li>
      {% if user.is_staff or user.player_profile and user.player_profile.is_captain %}
        <li class="nav-item"><a class="nav-link" href="{% url 'captain_dashboard' %}">Captain</a></li>
      {% endif %}
      {% if user.is_staff %}
        <li class="nav-item">
          <button class="nav-link btn btn-link w-100 text-start d-flex justify-content-between align-items-center"
                  type="button" data-bs-toggle="collapse" data-bs-target="#adminMenuMobile"
                  aria-expanded="false" aria-controls="adminMenuMobile">
            <span>Admin</span>
            <i class="bi bi-caret-down"></i>
          </button>
          <div id="adminMenuMobile" class="collapse ps-3 mt-1">
            <ul class="navbar-nav">
              <li><a class="nav-link" href="{% url 'admin_dashboard' %}">Dashboard</a></li>
              <li><hr class="dropdown-divider my-1"></li>
              <li><a class="nav-link" href="{% url 'admin_manage_schedule' %}">Manage Schedule</a></li>
              <li><a class="nav-link" href="{% url 'admin_manage_roster' %}">Manage Roster</a></li>
              <li><a class="nav-link" href="{% url 'admin_manage_scores' %}">Manage Scores</a></li>
              <li><a class="nav-link" href="{% url 'admin_manage_players' %}">Manage Players</a></li>
              <li><a class="nav-link" href="{% url 'admin_playoff_eligibility' %}">Playoff Eligibility</a></li>
              <li><a class="nav-link" href="{% url 'admin_league_standings' %}">League Standings</a></li>
            </ul>
          </div>
        </li>
      {% endif %}
      {% endif %}
    </ul>
    <hr>
    <ul class="navbar-nav mt-2">
      <li class="nav-item mb-2">
        <button id="themeToggleMobile" class="btn btn-outline-primary w-100" type="button" aria-label="Toggle dark mode">
          <i class="bi bi-moon-stars me-1"></i> Toggle Theme
        </button>
      </li>
      {% if user.is_authenticated %}
        <li class="nav-item"><a class="nav-link" href="{% url 'profile_edit' %}">Profile</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'notifications_list' %}">Notifications{% if notif_count %} ({{ notif_count }}){% endif %}</a></li>
        <li class="nav-item mt-2">
          <form id="logout-form-mobile" method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-link nav-link p-0">Logout</button>
          </form>
        </li>
      {% else %}
        <li class="nav-item"><a class="nav-link" href="{% url 'league_login' %}">Login</a></li>
      {% endif %}
    </ul>
  </div>
</div>
{% if messages %}
  <div class="position-fixed bottom-0 end-0 p-3 z-1080">
    <div id="toast-stack">
      {% for message in messages %}
        <div class="toast align-items-center show mb-2" role="status" aria-live="polite" aria-atomic="true" data-bs-delay="3500">
          <div class="toast-header">
            <strong class="me-auto">
              {% if 'success' in message.tags %}
                <span class="text-success">Success</span>
              {% elif 'error' in message.tags or 'danger' in message.tags %}
                <span class="text-danger">Error</span>
              {% else %}
                Notice
              {% endif %}
            </strong>
            <small class="text-muted">now</small>
            <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">
            {{ message }}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}
<div class="container">
  {% block content %}{% endblock %}
</div>
<div id="globalLoader" class="loader-overlay" aria-hidden="true" role="status" aria-label="Working">
  <img
    id="loaderBall"
    src="{% static 'images/tennis_ball.png' %}"
    data-logo-light="{% static 'images/tennis_ball.png' %}"
    data-logo-dark="{% static 'images/tennis_ball_white.png' %}"
    alt=""
    class="loader-ball"
  />
  <div class="loader-text">Working…</div>
</div>
<footer class="glass-footer">
  <div class="container py-2">
    <div class="d-flex justify-content-center align-items-center gap-2 small">
      <small>&copy; {% now "Y" %}</small>
      <span class="brand-chunk fw-semibold">Royals
        <!-- Tennis ball icon (inline SVG) -->
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" role="img">
          <defs>
            <linearGradient id="tbGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#eaff6a"/>
              <stop offset="100%" stop-color="#c7f14a"/>
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="10" fill="url(#tbGrad)" stroke="rgba(0,0,0,.12)" stroke-width="1"/>
          <path d="M4,12c4,0,6-3,8-3s4,3,8,3" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" opacity=".9"/>
          <path d="M4,12c4,0,6,3,8,3s4-3,8-3" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" opacity=".9"/>
        </svg>
        Industrial League</span>
    </div>
  </div>
</footer>
<div id="globalLoader" class="loader-overlay" aria-hidden="true" role="status" aria-label="Working">
  <img src="{% static 'images/tennis_ball.png' %}" alt="" class="loader-ball" />
  <div class="loader-text">Working…</div>
</div>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"
  defer></script>
<script src="{% static 'js/theme-toggle.js' %}" defer></script>
<script src="{% static 'js/rowlink.js' %}" defer></script>
<script src="{% static 'js/toast.js' %}" defer></script>
<script src="{% static 'js/nav-collapse.js' %}" defer></script>
<script src="{% static 'js/loader.js' %}" defer></script>
{% if SENTRY_BROWSER_DSN %}
<script id="sentry-init"
        src="{% static 'js/sentry.js' %}"
        data-dsn="{{ SENTRY_BROWSER_DSN }}"
        defer></script>
{% endif %}
</body>
</html>
