{% extends "league/base.html" %}
{% load static %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 mb-0">Playoff Eligibility</h1>
  <form method="get" class="d-inline-flex align-items-center">
    <label class="me-2 mb-0" for="season">Season</label>
    <select class="form-select theme-select" name="season" id="season" onchange="this.form.submit()">
      {% for s in seasons %}
        <option value="{{ s.id }}" {% if selected and s.id == selected.id %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>
  </form>
</div>

<div class="glass-card p-3">
  {% if selected %}
  <div class="table-responsive table-scroll-70">
    <table class="table glass-table table-hover table-compact table-glass-transparent table-sticky align-middle mb-0">
      <thead class="table-head-glass">
        <tr>
          <th>Player</th>
          <th class="text-center">S1</th>
          <th class="text-center">S2</th>
          <th class="text-center">S3</th>
          <th class="text-center">D1</th>
          <th class="text-center">D2</th>
          <th class="text-center">D3</th>
          <th class="text-center">Total</th>
          <th class="text-center">Points</th>
          <th class="text-center">W-L</th>
          <th class="text-center">Win%</th>
          <th class="text-center">Eligible</th>
        </tr>
      </thead>
      <tbody>
      {% for r in rows %}
        <tr>
          <td>{{ r.player.last_name }}, {{ r.player.first_name }}</td>

          {# S1/S2/S3: show badge if number eligible #}
          <td class="text-center">
            {{ r.S1 }}
            {% if r.elig1 %}<span class="badge bg-success ms-1">✓</span>{% endif %}
          </td>
          <td class="text-center">
            {{ r.S2 }}
            {% if r.elig2 %}<span class="badge bg-success ms-1">✓</span>{% endif %}
          </td>
          <td class="text-center">
            {{ r.S3 }}
            {% if r.elig3 %}<span class="badge bg-success ms-1">✓</span>{% endif %}
          </td>

          {# D1/D2/D3: same badges by number #}
          <td class="text-center">
            {{ r.D1 }}
            {% if r.elig1 %}<span class="badge bg-success ms-1">✓</span>{% endif %}
          </td>
          <td class="text-center">
            {{ r.D2 }}
            {% if r.elig2 %}<span class="badge bg-success ms-1">✓</span>{% endif %}
          </td>
          <td class="text-center">
            {{ r.D3 }}
            {% if r.elig3 %}<span class="badge bg-success ms-1">✓</span>{% endif %}
          </td>

          <td class="text-center fw-semibold">{{ r.total_matches }}</td>
          <td class="text-center">{{ r.points }}</td>
          <td class="text-center">{{ r.wins }}-{{ r.losses }}</td>
          <td class="text-center">{{ r.win_pct }}%</td>
          <td class="text-center">
            {% if r.overall_eligible %}
              <span class="badge bg-primary">Eligible</span>
            {% else %}
              <span class="badge bg-secondary">Not yet</span>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="12" class="text-muted">No roster for this season.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p class="text-muted mb-0">Select a season to view eligibility.</p>
  {% endif %}
</div>
{% endblock %}