{% load static %}
{% load tz %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>You've been assigned a sub match</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
      :root { color-scheme: light dark; }
      body { margin:0; background:#f5f7fb; font-family: -apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
      .wrapper { max-width: 560px; margin: 24px auto; background: #ffffff; border-radius: 12px; box-shadow: 0 6px 24px rgba(20,16,48,.08); overflow: hidden; }
      .header { padding: 24px; text-align: center; background: #ffffff; }
      .brand { vertical-align: middle; }
      .content { padding: 24px; color: #26243a; text-align:center; }
      h1 { margin: 0 0 8px; font-size: 20px; color: #5a2aa8; }
      p { margin: 0 0 12px; line-height: 1.5; }
      .button { display: inline-block; padding: 12px 18px; background: #5a2aa8; color:#fff !important; text-decoration: none; border-radius: 10px; font-weight: 600; }
      .muted { color:#666; font-size: 12px; margin-top: 16px; }
      .footer { text-align: center; color:#888; font-size: 12px; padding: 16px 24px 32px; }
      @media (prefers-color-scheme: dark) {
        body { background:#0f0e16; }
        .wrapper { background:#171525; box-shadow: 0 6px 24px rgba(0,0,0,.4); }
        .content { color:#e8e6f2; text-align:center; }
        h1 { color:#bca7ff; }
        .button { background:#bca7ff; color:#1a1333 !important; }
        .muted, .footer { color:#b3acca; }
        .header { background:#5a2aa8; }
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <div class="header">
        <img class="brand" src="{{ public_base_url }}{% static 'images/royal_tennis_ball.png' %}"
             alt="Royals Tennis Ball logo"
             width="120"
             style="display:block;width:120px;max-width:100%;height:auto;margin:0 auto;border:0;outline:none;text-decoration:none;">
      </div>
      <div class="content">
        <h1>You’ve been assigned a sub match</h1>
        {% with greet_name=recipient.first_name|default:user.first_name|default:"there" %}
          <p>Hi {{ greet_name }}, you’ve been selected to <strong>sub</strong> in this match.</p>
        {% endwith %}
        <p>
          <strong>Match:</strong>
          {% if match_dt or fixture or timeslot %}
            {# Date: prefer subplan match_dt date; else fixture date; avoid wrong times #}
            {% if match_dt %}
              {{ match_dt|localtime|date:"D M j" }}
            {% elif fixture %}
              {{ fixture.date|date:"D M j" }}
            {% endif %}
            {# Time: use subplan timeslot if present; else match_dt time; never use fixture.time #}
            {% if timeslot %}
              at {{ timeslot|slice:"0:2" }}:{{ timeslot|slice:"2:4" }}
            {% elif match_dt %}
              at {{ match_dt|localtime|date:"g:i a" }}
            {% endif %}
            {# Team they are subbing for #}
            {% if target_team_name %}
              — playing for {{ target_team_name }}
            {% elif sub_team_name %}
              — playing for {{ sub_team_name }}
            {% endif %}
            {# Keep home/away if fixture exists #}
            {% if fixture %}
              {% if fixture.home %}(Home){% else %}(Away){% endif %}
            {% endif %}
          {% else %}
            Upcoming match
          {% endif %}
        </p>
        {% with slot_text=slot_label|default:slot_name|default:"TBD" %}
          <p><strong>Slot:</strong> {{ slot_text }}</p>
        {% endwith %}
        {% if partner_full_name or partner_first_name or partner_last_name %}
          {% with partner_full=partner_full_name|default:"" %}
            {% if partner_full %}
              <p><strong>Partner:</strong> {{ partner_full }}</p>
            {% else %}
              <p><strong>Partner:</strong> {{ partner_first_name }}{% if partner_last_name %} {{ partner_last_name }}{% endif %}</p>
            {% endif %}
          {% endwith %}
        {% endif %}
        {% if target_team_name %}
          <p><strong>Subbing for:</strong> {{ target_team_name }}</p>
        {% endif %}
        {% if notes %}
          <p><strong>Notes:</strong> {{ notes }}</p>
        {% endif %}
        <p style="margin:20px 0">
          <a class="button" href="{% if fixture_url %}{{ fixture_url }}{% else %}{{ public_base_url }}{% url 'fixture_detail' pk=fixture.id %}{% endif %}">Match Details</a>
        </p>
        <p class="muted">If the button doesn’t work, copy and paste this link:<br>
          <span style="word-break:break-all">{% if fixture_url %}{{ fixture_url }}{% else %}{{ public_base_url }}{% url 'fixture_detail' pk=fixture.id %}{% endif %}</span>
        </p>
      </div>
      <div class="logo" style="text-align:center; margin:16px 0;">
        <img src="{{ public_base_url }}{% static 'images/royals_logo.png' %}"
             alt="Royals League Logo"
             width="120"
             style="display:block;width:120px;max-width:100%;height:auto;margin:0 auto;border:0;outline:none;text-decoration:none;">
      </div>
      <div class="footer">{{ now|date:"Y" }} Royals - Industrial League</div>
    </div>
  </body>
</html>